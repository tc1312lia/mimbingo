<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tap In Bingo | Melanated in Melbourne</title>
<style>
  :root {
    --mim-purple: #4527a0;
    --mim-dark: #1b0b30;
    --mim-gold: #ffca28;
    --mim-gold-soft: #ffd54f;
    --text-light: #fdf7ff;
    --text-muted: #cbb9e5;
  }

  body {
    margin: 0;
    min-height: 100vh;
    background: radial-gradient(circle at top, var(--mim-purple), var(--mim-dark));
    color: var(--text-light);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
  }

  .brand {
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--mim-gold);
    margin-bottom: 6px;
  }

  h1 {
    margin: 0 0 8px;
  }

  .subtitle {
    margin-bottom: 16px;
    color: var(--text-muted);
    text-align: center;
  }

  .banner {
    background: rgba(34, 21, 54, 0.85);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    margin-bottom: 14px;
  }

  /* 4x4 grid, fixed layout */
  .bingo-board {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    width: min(90vw, 450px);
    margin-bottom: 14px;
  }

  /* Perfect square cells */
  .square {
    background: rgba(28, 20, 52, 0.85);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 10px;
    aspect-ratio: 1 / 1;          /* üëà makes each cell a square */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    text-align: center;
    font-size: 0.8rem;
    line-height: 1.2;
    overflow-wrap: break-word;
    transition: all 0.3s ease;
  }

  .square.filled {
    background: var(--mim-gold);
    color: var(--mim-dark);
    font-weight: 600;
    box-shadow: 0 0 10px rgba(255, 213, 79, 0.5);
  }

  .reward {
    display: none;
    border: 1px solid var(--mim-gold-soft);
    border-radius: 12px;
    background: rgba(255, 214, 79, 0.1);
    color: var(--mim-gold);
    padding: 14px;
    text-align: center;
  }

  .mim-button {
    margin-top: 16px;
    display: inline-block;
    padding: 10px 18px;
    border-radius: 999px;
    background: var(--mim-gold);
    color: var(--mim-dark);
    font-weight: 600;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.2s ease;
  }

  .mim-button:hover {
    background: var(--mim-gold-soft);
  }
</style>

</head>
<body>
<div class="brand">Melanated in Melbourne</div>
<h1> Tap In Bingo</h1>
<p class="subtitle">Scan NFC tags around the space. Fill a row, column, or diagonal on your 4√ó4 board to win!</p>

<div id="message" class="banner">Loading‚Ä¶</div>
<div id="bingo-grid" class="bingo-board"></div>

<a href="https://www.melanatedinmelbourne.com/" class="mim-button"> Visit Melanated in Melbourne</a>

<div id="reward" class="reward">
üéâ Bingo! You‚Äôve completed a Tap In line ‚Äî show this to a host for your reward.
</div>

<script>
(function(){
const TRACKING_URL = 'https://script.google.com/macros/s/AKfycbw_sb0oc3qbJag8lU4g7tHWsWjdWZ9iUaoCtyyjZNn0H0Muurt92DOmT_RdjPVArW6nbw/exec';

function getPlayerId(){
 let id = localStorage.getItem('mim_player_id');
 if(!id){ id='player-'+Math.random().toString(36).slice(2)+Date.now().toString(36); localStorage.setItem('mim_player_id',id);}
 return id;
}
function getPlayerName(){
 let n=localStorage.getItem('mim_player_name');
 if(!n){n=prompt("Enter your name (first name or nickname):")||"Guest";localStorage.setItem('mim_player_name',n);}
 return n;
}
const playerId=getPlayerId();
const playerName=getPlayerName();
function sendLog(p){try{fetch(TRACKING_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify({...p,playerName})});}catch(e){}}

const ALL_TAGS={
tag1:{label:'Song of the Week',prompt:'Ask someone what their ‚Äúsong of the week‚Äù is and tell them yours.'},
tag2:{label:'Meet Someone New',prompt:'Find someone you haven‚Äôt met yet and ask what brought them here tonight.'},
tag3:{label:'Black and Better Than Ever',prompt:'What does being your best self look like ‚Äî even when the world doesn‚Äôt expect it from you?',episodeUrl:'https://youtu.be/58VMtwM_sdI?si=_UFEiYV1GHHw1yMS'},
tag4:{label:'Nicole',prompt:'Congrats! you found a host tag.'},
tag5:{label:'Laugh Together',prompt:'Find someone laughing and ask what made them laugh tonight.'},
tag6:{label:'Share a Goal',prompt:'Tell someone about a goal you‚Äôre working toward ‚Äî big or small.'},
tag7:{label:'Ri\'Chard',prompt:'Congrats! You found a host tag.'},
tag8:{label:'Solo Moment',prompt:'Take a breath. What‚Äôs something you‚Äôre grateful for in this moment?'},
tag9:{label:'Creative Spark',prompt:'Ask someone what inspires them to create, share, or show up lately.'},
tag10:{label:'Stories We Need',prompt:'What kind of stories do you wish you heard more often - in media or real life?',formUrl:'https://forms.gle/GC9ciHTfeSBCZJvC8'},
tag11:{label:'Grounded Space',prompt:'Think about what helps you feel grounded or safe. Take a pause here.'},
tag12:{label:'Gratitude Tap',prompt:'Share one thing that made you smile this week with someone nearby.'},
tag13:{label:'Find Someone in Yellow',prompt:'Find someone wearing yellow or gold and give them a compliment.'},
tag14:{label:'Your Soundtrack',prompt:'If we made a playlist for tonight, what song would you add ‚Äî and why?',formUrl:'https://forms.gle/Jy1NpRKfEQb8oMUh6'},
tag15:{label:'Community Wish',prompt:'What‚Äôs one thing you‚Äôd love to see more of in our creative communities?',formUrl:'https://forms.gle/GC9ciHTfeSBCZJvC8'},
tag16:{label:'Podcast Pitch',prompt:'If you could host an episode of MiM, what would your first topic be?',formUrl:'https://forms.gle/GC9ciHTfeSBCZJvC8'},
tag17:{label:'What Brings You Joy?',prompt:'Ask someone: ‚ÄúWhat‚Äôs been bringing you joy lately?‚Äù'},
tag18:{label:'Siki From the Block',prompt:'What part of your younger self still lives in you now?',episodeUrl:'https://youtu.be/QPbaF4X4w1g?si=c6xBObFhpGkcF1Tg'},
tag19:{label:'Deep Breath',prompt:'Pause. Take one deep breath ‚Äî remind yourself you belong here.'},
tag20:{label:'Find Your Way Back',prompt:'When was the last time you reconnected with something that once made you happy?',episodeUrl:'https://youtu.be/rJr2qPOjApE?si=MjKcM6s7vJHC7dGB'},
mim_home:{label:'Melanated in Melbourne',prompt:'Tap to visit our official site and explore more stories, events, and episodes.',episodeUrl:'https://www.melanatedinmelbourne.com/'}
};

const STORAGE_KEY='mim_bingo_v6';
let state=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{"collected":[],"layout":[],"bingoLogged":false}');
const allKeys=Object.keys(ALL_TAGS);

if(!state.layout||state.layout.length!==16){
 const pinned='mim_home';
 const random=shuffle(allKeys.filter(k=>k!==pinned)).slice(0,15);
 state.layout=[...random,pinned];
 state.collected=[];
 state.bingoLogged=false;
 localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
 sendLog({event:'board_created',playerId,tagId:null});
}
const TAGS={};
state.layout.forEach(k=>{TAGS[k]=ALL_TAGS[k];});

const params=new URLSearchParams(window.location.search);
const tagParam=(params.get('tag')||'').trim();
const messageEl=document.getElementById('message');
const grid=document.getElementById('bingo-grid');
const reward=document.getElementById('reward');

if(tagParam&&TAGS[tagParam]){
 const isNew=!state.collected.includes(tagParam);
 if(isNew){
  state.collected.push(tagParam);
  localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
  sendLog({event:'tag_unlocked',playerId,tagId:tagParam});
 }
 const cfg=TAGS[tagParam];
 let html=`<div style="font-weight:600;">‚úÖ You unlocked: ${cfg.label}</div>
 <div style="margin-top:6px;color:#cbb9e5;font-size:0.9rem;">${cfg.prompt}</div>`;
 if(cfg.episodeUrl||cfg.formUrl){
   const link=cfg.episodeUrl||cfg.formUrl;
   const label=cfg.episodeUrl?'üéß Listen':(cfg.formUrl?'üìù Open Form':'üåê Visit');
   const openNew=(cfg.episodeUrl||cfg.formUrl)?'target="_blank"':'';
   html+=`<a href="${link}" ${openNew} rel="noopener noreferrer"
   style="display:inline-block;margin-top:10px;padding:8px 14px;border-radius:999px;
   background:#ffca28;color:#3e2723;font-weight:600;font-size:0.85rem;text-decoration:none;">${label}</a>`;
 }
 messageEl.innerHTML=html;
}else if(!tagParam){messageEl.textContent='Tap a tag to fill your 4√ó4 Bingo board!';}
else{messageEl.textContent='That tag isn‚Äôt part of your board tonight.';}

renderBoard();checkBingo();

function renderBoard(){
 grid.innerHTML='';
 grid.style.gridTemplateColumns='repeat(4,1fr)';
 Object.entries(TAGS).forEach(([id,cfg])=>{
  const sq=document.createElement('div');
  sq.className='square'+(state.collected.includes(id)?' filled':'');
  sq.textContent=cfg.label;
  grid.appendChild(sq);
 });
}

function checkBingo(){
 const filled=state.collected;
 const ids=Object.keys(TAGS);
 const board=Array.from({length:4},(_,r)=>ids.slice(r*4,(r+1)*4));
 const row=board.some(r=>r.every(id=>filled.includes(id)));
 const col=[0,1,2,3].some(c=>board.every(r=>filled.includes(r[c])));
 const d1=board.every((r,i)=>filled.includes(r[i]));
 const d2=board.every((r,i)=>filled.includes(r[3-i]));
 if(row||col||d1||d2){
  reward.style.display='block';
  if(!state.bingoLogged){
   state.bingoLogged=true;
   localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
   sendLog({event:'bingo_completed',playerId,tagId:null});
  }
 }
}
function shuffle(a){return a.map(v=>({v,r:Math.random()})).sort((a,b)=>a.r-b.r).map(o=>o.v);}
})();
</script>
</body>
</html>
