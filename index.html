<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tap In Bingo | Melanated in Melbourne</title>

<style>
  :root {
    --mim-purple: #4527a0;
    --mim-dark: #1b0b30;
    --mim-gold: #ffca28;
    --mim-gold-soft: #ffd54f;
    --text-light: #fdf7ff;
    --text-muted: #cbb9e5;
  }

  body {
    margin: 0;
    min-height: 100vh;
    background: radial-gradient(circle at top, var(--mim-purple), var(--mim-dark));
    color: var(--text-light);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
  }

  .brand {
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--mim-gold);
    margin-bottom: 6px;
  }

  h1 { margin: 0 0 8px; }

  .subtitle {
    margin-bottom: 16px;
    color: var(--text-muted);
    text-align: center;
  }

  .banner {
    background: rgba(34, 21, 54, 0.85);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    margin-bottom: 14px;
    width: min(90vw, 520px);
  }

  /* 3x3 grid */
  .bingo-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    width: min(90vw, 360px);
    margin-bottom: 14px;
  }

  .square {
    background: rgba(28, 20, 52, 0.85);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 10px;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    text-align: center;
    font-size: 0.85rem;
    line-height: 1.2;
    overflow-wrap: break-word;
    transition: all 0.3s ease;
    user-select: none;
  }

  .square.filled {
    background: var(--mim-gold);
    color: var(--mim-dark);
    font-weight: 700;
    box-shadow: 0 0 10px rgba(255, 213, 79, 0.5);
  }

  /* Optional: visually mark role tiles (still on-brand) */
  .square.role {
    border: 2px solid rgba(255, 202, 40, 0.55);
  }

  .reward {
    display: none;
    border: 1px solid var(--mim-gold-soft);
    border-radius: 12px;
    background: rgba(255, 214, 79, 0.1);
    color: var(--mim-gold);
    padding: 14px;
    text-align: center;
    width: min(90vw, 520px);
  }

  .mim-button {
    margin-top: 16px;
    display: inline-block;
    padding: 10px 18px;
    border-radius: 999px;
    background: var(--mim-gold);
    color: var(--mim-dark);
    font-weight: 700;
    text-decoration: none;
    font-size: 0.95rem;
    transition: all 0.2s ease;
  }

  .mim-button:hover { background: var(--mim-gold-soft); }
</style>
</head>

<body>
  <div class="brand">Melanated in Melbourne</div>
  <h1>Tap In Bingo</h1>
  <p class="subtitle">
    Scan NFC tags around the space. Fill a row, column, or diagonal on your 3√ó3 board to win!
  </p>

  <div id="message" class="banner">Loading‚Ä¶</div>
  <div id="bingo-grid" class="bingo-board"></div>

  <a href="https://www.melanatedinmelbourne.com/" class="mim-button">Visit Melanated in Melbourne</a>

  <div id="reward" class="reward">
    üéâ Bingo! You‚Äôve completed a Tap In line ‚Äî show this to a host for your reward.
  </div>

<script>
(function () {
  // Keep your existing Google Apps Script endpoint (optional logging)
  const TRACKING_URL = 'https://script.google.com/macros/s/AKfycbw_sb0oc3qbJag8lU4g7tHWsWjdWZ9iUaoCtyyjZNn0H0Muurt92DOmT_RdjPVArW6nbw/exec';

  // 3√ó3 board config
  const BOARD_SIZE = 3;
  const BOARD_CELLS = BOARD_SIZE * BOARD_SIZE;

  // Bump version so everyone gets a fresh 3√ó3 layout
  const STORAGE_KEY = 'mim_bingo_v8';

  function getPlayerId() {
    let id = localStorage.getItem('mim_player_id');
    if (!id) {
      id = 'player-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
      localStorage.setItem('mim_player_id', id);
    }
    return id;
  }

  function getPlayerName() {
    let n = localStorage.getItem('mim_player_name');
    if (!n) {
      n = prompt("Enter your name (first name or nickname):") || "Guest";
      localStorage.setItem('mim_player_name', n);
    }
    return n;
  }

  const playerId = getPlayerId();
  const playerName = getPlayerName();

  function sendLog(payload) {
    try {
      fetch(TRACKING_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ...payload, playerName })
      });
    } catch (e) { /* ignore */ }
  }

  // All available tags (your existing tags + lanyard roles)
  const ALL_TAGS = {
    // ‚úÖ Lanyard role tags (always pinned)
    first_timer: { label: 'First-timer (Green)', prompt: 'Find someone wearing a GREEN lanyard and welcome them. Ask: ‚ÄúWhat brought you here tonight?‚Äù' },
    performer:   { label: 'Performe
